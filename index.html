<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CONCEPT SPACE | INFINITY ULTRA</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* =================================================================
           1. CORE CONFIGURATION (CSS VARIABLES)
           ================================================================= */
        :root {
            /* COLORS */
            --bg-body: #050505;
            --bg-panel: #121212;
            --bg-element: #1e1e1e;
            --bg-nav: rgba(10, 10, 10, 0.92);

            --text-primary: #ffffff;
            --text-secondary: #909090;
            --text-muted: #555555;

            /* ACCENTS */
            --accent-green: #00ff9d;       /* Main Brand Color */
            --accent-green-dim: rgba(0, 255, 157, 0.15);
            --accent-purple: #9d00ff;      /* Secondary */
            --accent-red: #ff2a6d;         /* Errors / Hot */
            --accent-yellow: #ffcc00;      /* Warning */

            /* UI PROPS */
            --glass: rgba(255, 255, 255, 0.05);
            --border: 1px solid rgba(255, 255, 255, 0.08);
            --shadow-card: 0 10px 30px rgba(0, 0, 0, 0.5);
            --radius-box: 16px;
            --radius-btn: 12px;

            /* ANIMATIONS */
            --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* RESET */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif; }
        
        body {
            background-color: var(--bg-body);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex; flex-direction: column;
            user-select: none;
        }

        /* BACKGROUND EFFECTS */
        #star-canvas {
            position: fixed; inset: 0; z-index: -1; pointer-events: none;
            background: radial-gradient(circle at 50% 120%, #112215 0%, #000 70%);
        }

        /* SCROLLBARS */
        ::-webkit-scrollbar { width: 0; height: 0; display: none; }

        /* =================================================================
           2. LOADER COMPONENT
           ================================================================= */
        #app-loader {
            position: fixed; inset: 0; background: #000; z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.6s var(--ease-smooth);
        }
        .loader-orbit {
            width: 60px; height: 60px; border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%; border-top-color: var(--accent-green);
            animation: spin 1s linear infinite; box-shadow: 0 0 30px var(--accent-green-dim);
        }
        .loader-text {
            margin-top: 20px; font-size: 14px; font-weight: 800; letter-spacing: 3px;
            background: linear-gradient(90deg, #fff, #666); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* =================================================================
           3. HEADER & SEARCH
           ================================================================= */
        .header {
            padding: 15px 20px; background: rgba(5,5,5,0.8); backdrop-filter: blur(20px);
            border-bottom: var(--border); z-index: 100; flex-shrink: 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .brand { font-size: 18px; font-weight: 900; letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px; text-transform: uppercase; }
        .brand i { color: var(--accent-green); filter: drop-shadow(0 0 8px var(--accent-green)); }
        
        .status-badge {
            font-size: 10px; font-weight: 700; background: var(--glass);
            padding: 4px 8px; border-radius: 20px; border: var(--border);
            display: flex; align-items: center; gap: 6px; color: var(--text-secondary);
        }
        .status-dot { width: 6px; height: 6px; background: var(--accent-green); border-radius: 50%; box-shadow: 0 0 6px var(--accent-green); animation: pulse 2s infinite; }

        /* =================================================================
           4. MAIN CONTENT AREA
           ================================================================= */
        .content-area {
            flex: 1; overflow-y: auto; overflow-x: hidden; padding-bottom: 100px;
            scroll-behavior: smooth; position: relative;
        }

        /* SEARCH BAR */
        .search-wrapper {
            position: sticky; top: 0; z-index: 90; padding: 15px;
            background: linear-gradient(180deg, rgba(5,5,5,0.95) 0%, rgba(5,5,5,0) 100%);
        }
        .search-box {
            position: relative; width: 100%;
        }
        .search-input {
            width: 100%; height: 46px; background: var(--bg-element); border: var(--border);
            border-radius: 14px; padding: 0 15px 0 44px; color: #fff; font-size: 14px;
            transition: 0.3s;
        }
        .search-input:focus { border-color: var(--accent-green); box-shadow: 0 0 20px var(--accent-green-dim); }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #666; }

        /* BANNERS / PROMO SLIDER (EDITABLE) */
        .promo-slider {
            display: flex; gap: 12px; overflow-x: auto; padding: 0 15px 20px 15px;
            scroll-snap-type: x mandatory; scroll-behavior: smooth;
        }
        .promo-slide {
            min-width: 92%; height: 180px; background: #111; border-radius: 20px;
            position: relative; overflow: hidden; scroll-snap-align: center;
            border: var(--border); box-shadow: var(--shadow-card);
        }
        .promo-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.75; transition: transform 0.5s; }
        .promo-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            display: flex; flex-direction: column; align-items: flex-start;
        }
        .promo-tag {
            font-size: 10px; font-weight: 800; color: #000; padding: 4px 10px;
            border-radius: 6px; margin-bottom: 6px; text-transform: uppercase;
        }
        .promo-title {
            font-size: 24px; font-weight: 900; line-height: 1; text-transform: uppercase;
            text-shadow: 0 4px 10px rgba(0,0,0,0.8);
        }

        /* CATEGORIES */
        .cat-list { display: flex; gap: 8px; overflow-x: auto; padding: 0 15px 15px 15px; }
        .cat-item {
            padding: 10px 22px; background: var(--bg-element); border-radius: 30px;
            font-size: 12px; font-weight: 700; color: #888; border: var(--border);
            white-space: nowrap; transition: 0.3s; cursor: pointer;
        }
        .cat-item.active {
            background: var(--accent-green); color: #000; border-color: var(--accent-green);
            box-shadow: 0 4px 15px var(--accent-green-dim); transform: scale(1.05);
        }

        /* PRODUCT GRID */
        .grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px;
            animation: fadeIn 0.6s ease;
        }
        .card {
            background: var(--bg-panel); border-radius: var(--radius-box); overflow: hidden;
            border: var(--border); position: relative; display: flex; flex-direction: column;
            transition: transform 0.2s;
        }
        .card:active { transform: scale(0.97); }

        .card-top { position: relative; width: 100%; padding-top: 100%; background: #080808; }
        .card-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        
        .card-status {
            position: absolute; top: 8px; left: 8px; display: flex; flex-direction: column; gap: 4px;
        }
        .badge {
            font-size: 9px; font-weight: 800; padding: 4px 8px; border-radius: 6px;
            color: #fff; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.1); text-transform: uppercase;
        }
        .badge.hot { color: var(--accent-red); border-color: var(--accent-red); }
        .badge.sale { color: var(--accent-purple); border-color: var(--accent-purple); }

        .fav-btn {
            position: absolute; top: 8px; right: 8px; width: 32px; height: 32px;
            background: rgba(0,0,0,0.6); border-radius: 50%; backdrop-filter: blur(4px);
            display: flex; align-items: center; justify-content: center; border: var(--border);
            color: #fff; transition: 0.3s; z-index: 5;
        }
        .fav-btn.active { background: #fff; color: var(--accent-red); transform: scale(1.1); }

        .card-body { padding: 12px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .card-title { font-size: 13px; font-weight: 600; line-height: 1.3; color: #eee; margin-bottom: 8px; }
        .card-price-row { display: flex; justify-content: space-between; align-items: flex-end; }
        .price { font-size: 16px; font-weight: 800; color: var(--accent-green); }
        .add-icon {
            width: 28px; height: 28px; background: rgba(255,255,255,0.1); border-radius: 8px;
            display: flex; align-items: center; justify-content: center; color: #fff;
        }

        /* =================================================================
           5. NAVIGATION BAR
           ================================================================= */
        .nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 85px;
            background: var(--bg-nav); backdrop-filter: blur(20px);
            border-top: var(--border); z-index: 200;
            display: flex; justify-content: space-around; padding-top: 15px;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            color: #555; font-size: 10px; font-weight: 700; width: 60px; position: relative;
            transition: 0.3s;
        }
        .nav-item i { font-size: 22px; transition: 0.3s; }
        .nav-item.active { color: var(--accent-green); }
        .nav-item.active i { transform: translateY(-4px); filter: drop-shadow(0 0 10px var(--accent-green)); }
        
        .nav-counter {
            position: absolute; top: -2px; right: 12px; background: var(--accent-red);
            color: #fff; font-size: 9px; min-width: 16px; height: 16px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center; border: 2px solid #000;
            transform: scale(0); transition: 0.4s var(--ease-elastic);
        }
        .nav-counter.visible { transform: scale(1); }

        /* =================================================================
           6. SHEETS & MODALS
           ================================================================= */
        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 300; opacity: 0; pointer-events: none; transition: 0.4s;
        }
        .overlay.show { opacity: 1; pointer-events: all; }

        .sheet {
            position: fixed; bottom: 0; left: 0; width: 100%; background: #0f0f0f;
            border-radius: 24px 24px 0 0; z-index: 301; border-top: 1px solid #333;
            transform: translateY(110%); transition: transform 0.5s var(--ease-elastic);
            padding: 25px; display: flex; flex-direction: column; max-height: 85vh;
            box-shadow: 0 -20px 50px rgba(0,0,0,0.8);
        }
        .sheet.show { transform: translateY(0); }

        /* DETAIL SHEET */
        .detail-header { display: flex; gap: 20px; margin-bottom: 25px; }
        .detail-img { width: 100px; height: 100px; border-radius: 16px; object-fit: cover; background: #222; border: var(--border); }
        .detail-meta { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        
        .opt-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 30px; }
        .opt-chip {
            padding: 8px 16px; background: #1a1a1a; border: 1px solid #333; border-radius: 10px;
            font-size: 12px; color: #888; font-weight: 600; transition: 0.2s;
        }
        .opt-chip.selected { background: var(--accent-green-dim); border-color: var(--accent-green); color: var(--accent-green); }

        .btn-main {
            width: 100%; height: 50px; background: var(--accent-green); color: #000;
            border: none; border-radius: 14px; font-weight: 800; font-size: 14px;
            letter-spacing: 0.5px; text-transform: uppercase; display: flex;
            justify-content: center; align-items: center; gap: 10px;
            box-shadow: 0 5px 20px var(--accent-green-dim);
        }
        .btn-main:active { transform: scale(0.98); opacity: 0.9; }
        
        /* CART SHEET */
        .cart-list { flex: 1; overflow-y: auto; margin-bottom: 20px; }
        .cart-item {
            display: flex; align-items: center; gap: 12px; padding: 10px;
            background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 10px;
            border: var(--border);
        }

        /* =================================================================
           7. ADMIN PANEL
           ================================================================= */
        .admin-float-btn {
            position: fixed; bottom: 100px; right: 20px; width: 50px; height: 50px;
            background: rgba(20,20,20,0.9); backdrop-filter: blur(10px);
            border-radius: 50%; color: #666; display: flex; align-items: center; justify-content: center;
            border: 1px solid #444; z-index: 150; transition: 0.3s;
        }
        .admin-float-btn:active { color: var(--accent-green); border-color: var(--accent-green); transform: scale(0.9); }

        .admin-panel {
            position: fixed; inset: 0; background: #000; z-index: 500;
            transform: translateX(100%); transition: 0.3s var(--ease-smooth);
            display: flex; flex-direction: column;
        }
        .admin-panel.open { transform: translateX(0); }
        
        .adm-nav { padding: 15px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; background: #080808; }
        .adm-tabs { display: flex; background: #080808; border-bottom: 1px solid #222; }
        .adm-tab { flex: 1; padding: 15px; text-align: center; font-size: 11px; font-weight: 800; color: #555; letter-spacing: 1px; }
        .adm-tab.active { color: var(--accent-green); border-bottom: 2px solid var(--accent-green); background: rgba(0,255,157,0.05); }

        .adm-content { flex: 1; overflow-y: auto; padding: 20px; }
        
        .adm-card { background: #111; padding: 15px; border-radius: 14px; border: 1px solid #222; margin-bottom: 15px; }
        .adm-input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 10px; font-size: 13px; }
        .adm-input:focus { border-color: var(--accent-green); }

        .adm-file-label {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            background: #1a1a1a; padding: 12px; border: 1px dashed #444; border-radius: 10px;
            color: #888; font-size: 12px; margin-bottom: 10px;
        }

        /* TOAST NOTIFICATION */
        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: rgba(20,20,20,0.98); backdrop-filter: blur(12px); border: 1px solid #333;
            padding: 12px 24px; border-radius: 40px; display: flex; align-items: center; gap: 10px;
            z-index: 9999; transition: 0.5s var(--ease-elastic); opacity: 0; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }
        #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        #toast.success i { color: var(--accent-green); }
        #toast.error i { color: var(--accent-red); }

        /* ANIMATIONS */
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <canvas id="star-canvas"></canvas>

    <div id="app-loader">
        <div class="loader-orbit"></div>
        <div class="loader-text">INFINITY ULTRA</div>
        <div style="margin-top:5px; font-size:10px; color:#444;">CONCEPT SPACE</div>
    </div>

    <header class="header">
        <div class="brand"><i class="fas fa-meteor"></i> CONCEPT SPACE</div>
        <div class="status-badge"><div class="status-dot"></div> ONLINE</div>
    </header>

    <div class="content-area" id="main-scroll">
        
        <div id="view-home" class="view-section">
            <div class="search-wrapper">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="search-input" placeholder="–ù–∞–π—Ç–∏ –∂–∏–∂—É, –ø–æ–¥, –∏—Å–ø–∞—Ä...">
                </div>
            </div>

            <div class="promo-slider" id="promo-container">
                </div>

            <div class="cat-list" id="cat-container"></div>

            <div class="grid" id="prod-grid"></div>
        </div>

        <div id="view-fav" class="view-section" style="display:none; padding-top:20px;">
            <h2 style="padding:0 20px 20px; font-size:20px; font-weight:800;">–í–∏—à-–ª–∏—Å—Ç <span style="color:var(--accent-red)">‚ù§</span></h2>
            <div class="grid" id="fav-grid"></div>
        </div>

        <div id="view-profile" class="view-section" style="display:none; padding:20px;">
            <div style="background: linear-gradient(180deg, rgba(255,255,255,0.05), transparent); border-radius:24px; padding:30px; text-align:center; border:1px solid #222; margin-bottom:20px;">
                <div style="width:80px; height:80px; border-radius:50%; background:#000; border:2px solid var(--accent-green); margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:30px; color:#fff; box-shadow:0 0 20px var(--accent-green-dim);">
                    <i class="fas fa-user-astronaut"></i>
                </div>
                <h2 id="profile-name" style="font-size:22px; margin-bottom:5px;">–ì–æ—Å—Ç—å</h2>
                <div style="color:var(--accent-green); font-size:11px; font-weight:bold; letter-spacing:1px;">CLIENT LEVEL 1</div>
            </div>
            
            <div style="background:#121212; border-radius:16px; border:1px solid #222; overflow:hidden;">
                <div onclick="window.open('https://t.me/Lacky337')" style="padding:15px; border-bottom:1px solid #222; display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; gap:10px; align-items:center;"><i class="fas fa-headset" style="color:#666"></i> –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                    <i class="fas fa-chevron-right" style="font-size:12px; color:#444;"></i>
                </div>
                <div onclick="clearCache()" style="padding:15px; display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; gap:10px; align-items:center;"><i class="fas fa-broom" style="color:#666"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</div>
                    <i class="fas fa-chevron-right" style="font-size:12px; color:#444;"></i>
                </div>
            </div>
        </div>

    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="switchView('home', this)">
            <i class="fas fa-home"></i> <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </div>
        <div class="nav-item" onclick="switchView('fav', this)">
            <i class="fas fa-heart"></i> <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </div>
        <div class="nav-item" onclick="openCart()">
            <div class="nav-counter" id="cart-counter">0</div>
            <i class="fas fa-shopping-bag"></i> <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        </div>
        <div class="nav-item" onclick="switchView('profile', this)">
            <i class="fas fa-user"></i> <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </nav>

    <div class="overlay" id="overlay" onclick="closeAll()"></div>

    <div class="sheet" id="sheet-prod">
        <div class="detail-header">
            <img id="pd-img" class="detail-img">
            <div class="detail-meta">
                <div id="pd-stock" style="font-size:10px; font-weight:800; color:#666; margin-bottom:5px;">IN STOCK</div>
                <h2 id="pd-title" style="font-size:20px; line-height:1.2; margin-bottom:5px;">Product Name</h2>
                <div id="pd-price" style="font-size:22px; font-weight:900; color:var(--accent-green);">0 ‚Ç¨</div>
            </div>
        </div>

        <div style="margin-bottom:10px; font-size:11px; font-weight:800; color:#666; text-transform:uppercase;">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é</div>
        <div class="opt-group" id="pd-opts"></div>

        <div style="margin-top:auto; display:flex; gap:12px;">
            <div style="display:flex; align-items:center; background:#222; border-radius:14px; padding:0 15px; gap:15px;">
                <i class="fas fa-minus" onclick="modQty(-1)" style="color:#fff;"></i>
                <span id="pd-qty" style="font-weight:800; width:20px; text-align:center;">1</span>
                <i class="fas fa-plus" onclick="modQty(1)" style="color:#fff;"></i>
            </div>
            <button class="btn-main" id="btn-add-cart" onclick="addToCart()">–í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <div class="sheet" id="sheet-cart" style="height:90vh;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="font-size:22px; font-weight:800;">–ö–æ—Ä–∑–∏–Ω–∞</h2>
            <div onclick="clearCart()" style="color:var(--accent-red); font-size:11px; font-weight:800; cursor:pointer;">–û–ß–ò–°–¢–ò–¢–¨</div>
        </div>

        <div class="cart-list" id="cart-list"></div>

        <div style="background:#161616; padding:20px; border-radius:20px; border:1px solid #333;">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-size:20px; font-weight:800; color:#fff;">
                <span>–ò—Ç–æ–≥–æ:</span> <span id="cart-total">0 ‚Ç¨</span>
            </div>
            <button class="btn-main" onclick="checkout()">
                –û–§–û–†–ú–ò–¢–¨ <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <div class="admin-float-btn" onclick="openAuth()"><i class="fas fa-fingerprint"></i></div>

    <div class="admin-panel" id="admin-panel">
        <div class="adm-nav">
            <div style="font-weight:900; font-size:16px; color:var(--accent-green);">CS:ADMIN <span style="color:#fff">ULTRA</span></div>
            <i class="fas fa-times" onclick="toggleAdmin(false)" style="font-size:20px; padding:10px;"></i>
        </div>
        <div class="adm-tabs">
            <div class="adm-tab active" onclick="setTab('prod')">–¢–û–í–ê–†–´</div>
            <div class="adm-tab" onclick="setTab('promo')">–ü–†–û–ú–û</div>
            <div class="adm-tab" onclick="setTab('cats')">–ö–ê–¢–ï–ì–û–†–ò–ò</div>
        </div>

        <div class="adm-content" id="adm-content">
            
            <div id="tab-prod">
                <div class="adm-card">
                    <div style="font-weight:bold; margin-bottom:15px; display:flex; justify-content:space-between;">
                        <span>–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–æ–≤–∞—Ä–∞</span>
                        <span onclick="resetForm()" style="color:var(--accent-red); font-size:10px;">–°–ë–†–û–°</span>
                    </div>
                    <input id="nf-name" class="adm-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="nf-price" class="adm-input" placeholder="–¶–µ–Ω–∞">
                        <input type="number" id="nf-stock" class="adm-input" placeholder="–°—Ç–æ–∫">
                    </div>
                    <select id="nf-cat" class="adm-input"></select>
                    <input id="nf-opts" class="adm-input" placeholder="–í–∫—É—Å—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)">
                    <input id="nf-img" class="adm-input" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ..." onchange="updPreview(this.value, 'prev-prod')">
                    
                    <label class="adm-file-label">
                        <i class="fas fa-camera"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                        <input type="file" accept="image/*" style="display:none" onchange="handleUpload(this, 'nf-img', 'prev-prod')">
                    </label>
                    <img id="prev-prod" style="width:100%; height:120px; object-fit:cover; border-radius:10px; margin-bottom:10px; display:none;">

                    <button class="btn-main" onclick="saveProduct()" style="height:40px;">–°–û–•–†–ê–ù–ò–¢–¨</button>
                </div>
                <div id="adm-prod-list"></div>
            </div>

            <div id="tab-promo" style="display:none;">
                <div class="adm-card">
                    <div style="font-weight:bold; margin-bottom:15px;">–ù–æ–≤—ã–π —Å–ª–∞–π–¥</div>
                    <input id="bf-title" class="adm-input" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ (SUMMER DROP)">
                    <div style="display:flex; gap:10px;">
                        <input id="bf-badge" class="adm-input" placeholder="–ü–ª–∞—à–∫–∞ (NEW)">
                        <select id="bf-color" class="adm-input">
                            <option value="#00ff9d">–ó–µ–ª–µ–Ω—ã–π</option>
                            <option value="#9d00ff">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                            <option value="#ff2a6d">–ö—Ä–∞—Å–Ω—ã–π</option>
                        </select>
                    </div>
                    <input id="bf-img" class="adm-input" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –±–∞–Ω–Ω–µ—Ä..." onchange="updPreview(this.value, 'prev-ban')">
                    
                    <label class="adm-file-label">
                        <i class="fas fa-image"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–Ω–Ω–µ—Ä
                        <input type="file" accept="image/*" style="display:none" onchange="handleUpload(this, 'bf-img', 'prev-ban')">
                    </label>
                    <img id="prev-ban" style="width:100%; height:80px; object-fit:cover; border-radius:10px; margin-bottom:10px; display:none;">

                    <button class="btn-main" onclick="saveBanner()" style="height:40px;">–î–û–ë–ê–í–ò–¢–¨</button>
                </div>
                <div style="font-size:10px; font-weight:bold; color:#666; margin-bottom:10px;">–ê–ö–¢–ò–í–ù–´–ï –ë–ê–ù–ù–ï–†–´</div>
                <div id="adm-ban-list"></div>
            </div>

            <div id="tab-cats" style="display:none;">
                <div class="adm-card">
                    <input id="cf-id" class="adm-input" placeholder="ID (vape, pod...)">
                    <input id="cf-name" class="adm-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–í–µ–π–ø—ã)">
                    <button class="btn-main" onclick="saveCat()" style="height:40px;">–°–û–ó–î–ê–¢–¨</button>
                </div>
                <div id="adm-cat-list"></div>
            </div>

        </div>
    </div>

    <div id="auth-modal" style="position:fixed; inset:0; background:#000; z-index:1000; display:none; flex-direction:column; align-items:center; justify-content:center;">
        <i class="fas fa-shield-alt" style="font-size:50px; color:#333; margin-bottom:20px;"></i>
        <div style="font-size:12px; letter-spacing:2px; color:#666; margin-bottom:10px;">SECURITY CLEARANCE</div>
        <input type="password" id="auth-pin" class="adm-input" style="width:180px; text-align:center; font-size:24px; letter-spacing:5px;" placeholder="PIN">
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn-main" onclick="checkAuth()" style="width:120px;">LOGIN</button>
            <button class="btn-main" onclick="closeAuth()" style="width:80px; background:#222;">EXIT</button>
        </div>
    </div>

    <div id="toast"><i class="fas fa-check-circle"></i> <span id="toast-msg">Success</span></div>

    <script>
        // =================================================================
        // CONFIG & STATE
        // =================================================================
        const CFG = {
            BIN_ID: "696e703dae596e708fe71325",
            API_KEY: "$2a$10$KhVEyfwrswNvk7dNQEJWPezsQABoaOnmNm/jtb8vqYWBJrL8eciFm",
            ADMIN_PIN: "Inn2708inNfnaf1234",
            TG_OWNER: "Lacky337"
        };

        // GLOBAL STATE STORE (Fully Synchronized)
        let STATE = {
            products: [],
            categories: [
                {id: 'all', name: '–í—Å–µ'},
                {id: 'pod', name: 'Pods'},
                {id: 'liquid', name: '–ñ–∏–∂–∏'}
            ],
            banners: [
                {id: 1, title: 'WELCOME TO SPACE', badge: 'NEW', color: '#00ff9d', img: 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?auto=format&fit=crop&w=1000&q=80'}
            ]
        };

        let USER = { cart: [], favs: [] };
        let UI = { activeCat: 'all', curProd: null, editId: null };
        const tg = window.Telegram.WebApp;

        // =================================================================
        // INITIALIZATION
        // =================================================================
        window.onload = async () => {
            tg.ready(); tg.expand();
            initStars();
            
            // Load Local Data
            const local = localStorage.getItem('cs_user_v1');
            if(local) USER = JSON.parse(local);
            
            // Set User Info
            if(tg.initDataUnsafe?.user) {
                const u = tg.initDataUnsafe.user;
                document.getElementById('profile-name').innerText = `${u.first_name} ${u.last_name || ''}`;
            }

            // Sync with Cloud
            await cloudLoad();
            
            // Render
            renderAll();
            
            // Hide Loader
            setTimeout(() => {
                const l = document.getElementById('app-loader');
                l.style.opacity = '0';
                setTimeout(() => l.style.display = 'none', 600);
            }, 800);

            // Listeners
            document.getElementById('search-input').addEventListener('input', (e) => renderGrid(e.target.value));
        };

        // =================================================================
        // CLOUD SYNC ENGINE (ROBUST)
        // =================================================================
        async function cloudLoad() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CFG.BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': CFG.API_KEY }
                });
                if(res.ok) {
                    const json = await res.json();
                    const data = json.record;
                    // Safely merge data to avoid overwriting with nulls
                    if(data.products) STATE.products = data.products;
                    if(data.categories) STATE.categories = data.categories;
                    if(data.banners && data.banners.length) STATE.banners = data.banners;
                }
            } catch(e) { console.error("Offline Mode"); showToast("Offline Mode", true); }
        }

        async function cloudSave() {
            showToast("–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...");
            try {
                // Save the ENTIRE state object
                await fetch(`https://api.jsonbin.io/v3/b/${CFG.BIN_ID}`, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-Master-Key': CFG.API_KEY 
                    },
                    body: JSON.stringify(STATE)
                });
                showToast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
            } catch(e) { showToast("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è", true); }
        }

        // =================================================================
        // RENDERING UI
        // =================================================================
        function renderAll() {
            renderBanners();
            renderCats();
            renderGrid();
            updateCartBadge();
        }

        function renderBanners() {
            const c = document.getElementById('promo-container');
            c.innerHTML = '';
            if(!STATE.banners.length) return;
            
            STATE.banners.forEach(b => {
                c.innerHTML += `
                <div class="promo-slide">
                    <img src="${b.img}" class="promo-img">
                    <div class="promo-overlay">
                        <span class="promo-tag" style="background:${b.color}">${b.badge}</span>
                        <div class="promo-title">${b.title}</div>
                    </div>
                </div>`;
            });
        }

        function renderCats() {
            const c = document.getElementById('cat-container');
            const sel = document.getElementById('nf-cat');
            c.innerHTML = ''; sel.innerHTML = '';
            
            STATE.categories.forEach(cat => {
                // Frontend Chip
                const el = document.createElement('div');
                el.className = `cat-item ${UI.activeCat === cat.id ? 'active' : ''}`;
                el.innerText = cat.name;
                el.onclick = () => {
                    UI.activeCat = cat.id;
                    renderCats(); renderGrid();
                    tg.HapticFeedback.selectionChanged();
                };
                c.appendChild(el);

                // Admin Select Option
                if(cat.id !== 'all') {
                    sel.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                }
            });
        }

        function renderGrid(query = '') {
            const grid = document.getElementById('prod-grid');
            grid.innerHTML = '';
            const q = query.toLowerCase();

            const items = STATE.products.filter(p => {
                const matchCat = UI.activeCat === 'all' || p.cat === UI.activeCat;
                const matchName = p.name.toLowerCase().includes(q);
                return matchCat && matchName;
            });

            if(!items.length) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px; color:#555;">–ü–£–°–¢–û–¢–ê...</div>';
                return;
            }

            items.forEach(p => {
                const isFav = USER.favs.includes(p.id);
                grid.innerHTML += `
                <div class="card" onclick="openProd(${p.id})">
                    <div class="card-top">
                        <img src="${p.img}" class="card-img" loading="lazy">
                        <div class="card-status">
                            ${p.stock < 1 ? '<span class="badge hot">SOLD OUT</span>' : ''}
                            ${p.stock > 0 && p.stock < 5 ? '<span class="badge sale">LOW STOCK</span>' : ''}
                        </div>
                        <div class="fav-btn ${isFav?'active':''}" onclick="event.stopPropagation(); toggleFav(${p.id})">
                            <i class="${isFav?'fas':'far'} fa-heart"></i>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-title">${p.name}</div>
                        <div class="card-price-row">
                            <div class="price">${p.price} ‚Ç¨</div>
                            <div class="add-icon"><i class="fas fa-plus"></i></div>
                        </div>
                    </div>
                </div>`;
            });
        }

        function renderFavs() {
            const grid = document.getElementById('fav-grid');
            grid.innerHTML = '';
            const items = STATE.products.filter(p => USER.favs.includes(p.id));
            
            if(!items.length) { grid.innerHTML = '<div style="color:#555; text-align:center;">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö</div>'; return; }

            items.forEach(p => {
                grid.innerHTML += `
                <div class="card" onclick="openProd(${p.id})">
                    <div class="card-top">
                        <img src="${p.img}" class="card-img">
                        <div class="fav-btn active" onclick="event.stopPropagation(); toggleFav(${p.id})"><i class="fas fa-heart"></i></div>
                    </div>
                    <div class="card-body">
                        <div class="card-title">${p.name}</div>
                        <div class="price">${p.price} ‚Ç¨</div>
                    </div>
                </div>`;
            });
        }

        // =================================================================
        // PRODUCT LOGIC
        // =================================================================
        function openProd(id) {
            UI.curProd = STATE.products.find(x => x.id === id);
            if(!UI.curProd) return;

            document.getElementById('pd-img').src = UI.curProd.img;
            document.getElementById('pd-title').innerText = UI.curProd.name;
            document.getElementById('pd-price').innerText = UI.curProd.price + " ‚Ç¨";
            
            const stock = document.getElementById('pd-stock');
            const btn = document.getElementById('btn-add-cart');
            
            if(UI.curProd.stock < 1) {
                stock.innerText = "SOLD OUT"; stock.style.color = "var(--accent-red)";
                btn.style.opacity = 0.5; btn.style.pointerEvents = "none"; btn.innerText = "–ù–ï–¢ –í –ù–ê–õ–ò–ß–ò–ò";
            } else {
                stock.innerText = `–í –ù–ê–õ–ò–ß–ò–ò: ${UI.curProd.stock}`; stock.style.color = "#666";
                btn.style.opacity = 1; btn.style.pointerEvents = "all"; btn.innerText = "–í –ö–û–†–ó–ò–ù–£";
            }

            // Options
            const optsBox = document.getElementById('pd-opts');
            optsBox.innerHTML = '';
            const opts = UI.curProd.opts && UI.curProd.opts.length ? UI.curProd.opts : ['Standard'];
            UI.curProd._selOpt = opts[0];
            UI.curProd._qty = 1;

            opts.forEach(o => {
                const ch = document.createElement('div');
                ch.className = `opt-chip ${o === opts[0] ? 'selected' : ''}`;
                ch.innerText = o;
                ch.onclick = () => {
                    UI.curProd._selOpt = o;
                    document.querySelectorAll('.opt-chip').forEach(x => x.classList.remove('selected'));
                    ch.classList.add('selected');
                };
                optsBox.appendChild(ch);
            });

            document.getElementById('pd-qty').innerText = 1;
            openSheet('sheet-prod');
        }

        function modQty(d) {
            const newQ = UI.curProd._qty + d;
            if(newQ < 1) return;
            if(newQ > UI.curProd.stock) return showToast("–ú–∞–∫—Å–∏–º—É–º –≤ –Ω–∞–ª–∏—á–∏–∏", true);
            UI.curProd._qty = newQ;
            document.getElementById('pd-qty').innerText = newQ;
            document.getElementById('pd-price').innerText = (UI.curProd.price * newQ).toFixed(2) + " ‚Ç¨";
        }

        function addToCart() {
            const item = {
                id: UI.curProd.id,
                name: UI.curProd.name,
                price: UI.curProd.price,
                img: UI.curProd.img,
                opt: UI.curProd._selOpt,
                q: UI.curProd._qty
            };
            
            const exist = USER.cart.find(x => x.id === item.id && x.opt === item.opt);
            if(exist) exist.q += item.q;
            else USER.cart.push(item);
            
            saveUser();
            closeAll();
            showToast("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É");
            tg.HapticFeedback.notificationOccurred('success');
        }

        function toggleFav(id) {
            if(USER.favs.includes(id)) USER.favs = USER.favs.filter(x=>x!==id);
            else USER.favs.push(id);
            saveUser();
            renderGrid(); // Refresh icons
            if(document.getElementById('view-fav').style.display === 'block') renderFavs();
        }

        // =================================================================
        // CART
        // =================================================================
        function openCart() {
            const l = document.getElementById('cart-list');
            l.innerHTML = '';
            let total = 0;

            if(!USER.cart.length) l.innerHTML = '<div style="text-align:center; padding:30px; color:#555">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
            
            USER.cart.forEach((item, i) => {
                total += item.price * item.q;
                l.innerHTML += `
                <div class="cart-item">
                    <img src="${item.img}" style="width:50px; height:50px; border-radius:8px; object-fit:cover;">
                    <div style="flex:1">
                        <div style="font-weight:bold; font-size:13px;">${item.name}</div>
                        <div style="font-size:11px; color:#888;">${item.opt}</div>
                        <div style="color:var(--accent-green); font-size:12px;">${(item.price*item.q).toFixed(2)} ‚Ç¨</div>
                    </div>
                    <div style="font-weight:bold; font-size:14px; margin-right:10px;">x${item.q}</div>
                    <i class="fas fa-trash" style="color:#444;" onclick="delCart(${i})"></i>
                </div>`;
            });

            document.getElementById('cart-total').innerText = total.toFixed(2) + " ‚Ç¨";
            openSheet('sheet-cart');
        }

        function delCart(i) { USER.cart.splice(i, 1); saveUser(); openCart(); }
        function clearCart() { USER.cart = []; saveUser(); openCart(); }

        function checkout() {
            if(!USER.cart.length) return;
            let m = "üöÄ *–ó–ê–ö–ê–ó CS ULTRA*\n\n";
            USER.cart.forEach(x => m += `‚ñ™Ô∏è ${x.name} [${x.opt}] x${x.q} = ${x.price*x.q}‚Ç¨\n`);
            m += `\nüí∞ –ò–¢–û–ì–û: ${document.getElementById('cart-total').innerText}`;
            window.open(`https://t.me/${CFG.TG_OWNER}?text=${encodeURIComponent(m)}`);
            tg.close();
        }

        // =================================================================
        // ADMIN PANEL
        // =================================================================
        function openAuth() { document.getElementById('auth-modal').style.display = 'flex'; }
        function closeAuth() { document.getElementById('auth-modal').style.display = 'none'; }
        
        function checkAuth() {
            if(document.getElementById('auth-pin').value === CFG.ADMIN_PIN) {
                closeAuth();
                toggleAdmin(true);
                renderAdmList();
                renderAdmPromo();
                renderAdmCats();
            } else {
                showToast("–ù–µ–≤–µ—Ä–Ω—ã–π PIN", true);
                tg.HapticFeedback.notificationOccurred('error');
            }
        }
        function toggleAdmin(o) {
            const p = document.getElementById('admin-panel');
            o ? p.classList.add('open') : p.classList.remove('open');
        }

        function setTab(t) {
            document.querySelectorAll('.adm-tab').forEach(x=>x.classList.remove('active'));
            event.target.classList.add('active');
            ['prod','promo','cats'].forEach(id => document.getElementById('tab-'+id).style.display='none');
            document.getElementById('tab-'+t).style.display='block';
        }

        // --- ADMIN PRODUCTS ---
        function renderAdmList() {
            const l = document.getElementById('adm-prod-list');
            l.innerHTML = '';
            STATE.products.forEach(p => {
                l.innerHTML += `
                <div style="background:#1a1a1a; padding:10px; border-radius:10px; margin-bottom:10px; display:flex; align-items:center; gap:10px; border:1px solid #333;">
                    <img src="${p.img}" style="width:40px; height:40px; border-radius:6px; object-fit:cover;">
                    <div style="flex:1; font-size:12px;"><b>${p.name}</b><br><span style="color:#666">${p.stock} —à—Ç</span></div>
                    <i class="fas fa-pen" style="color:#888; padding:10px;" onclick="editProd(${p.id})"></i>
                    <i class="fas fa-trash" style="color:var(--accent-red); padding:10px;" onclick="delProd(${p.id})"></i>
                </div>`;
            });
        }
        async function saveProduct() {
            const name = document.getElementById('nf-name').value;
            const price = parseFloat(document.getElementById('nf-price').value);
            const stock = parseInt(document.getElementById('nf-stock').value);
            const cat = document.getElementById('nf-cat').value;
            const img = document.getElementById('nf-img').value;
            const opts = document.getElementById('nf-opts').value.split(',').map(x=>x.trim()).filter(Boolean);

            if(!name || !price) return showToast("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!", true);

            const item = { id: UI.editId || Date.now(), name, price, stock, cat, img, opts };
            
            if(UI.editId) {
                const idx = STATE.products.findIndex(x => x.id === UI.editId);
                STATE.products[idx] = item;
            } else {
                STATE.products.unshift(item);
            }
            
            await cloudSave();
            renderAdmList(); renderGrid(); resetForm();
        }
        function editProd(id) {
            const p = STATE.products.find(x => x.id === id);
            UI.editId = id;
            document.getElementById('nf-name').value = p.name;
            document.getElementById('nf-price').value = p.price;
            document.getElementById('nf-stock').value = p.stock;
            document.getElementById('nf-cat').value = p.cat;
            document.getElementById('nf-img').value = p.img;
            document.getElementById('nf-opts').value = p.opts ? p.opts.join(', ') : '';
            updPreview(p.img, 'prev-prod');
            document.getElementById('tab-prod').scrollIntoView();
        }
        function delProd(id) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å?")) {
                STATE.products = STATE.products.filter(x => x.id !== id);
                cloudSave(); renderAdmList(); renderGrid();
            }
        }
        function resetForm() {
            UI.editId = null;
            document.querySelectorAll('#tab-prod input').forEach(i => i.value = '');
            document.getElementById('prev-prod').style.display='none';
        }

        // --- ADMIN PROMO (BANNERS) ---
        function renderAdmPromo() {
            const l = document.getElementById('adm-ban-list');
            l.innerHTML = '';
            STATE.banners.forEach((b, idx) => {
                l.innerHTML += `
                <div style="background:#1a1a1a; padding:10px; border-radius:10px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <img src="${b.img}" style="width:60px; height:30px; object-fit:cover; border-radius:4px;">
                        <div style="font-size:11px;"><b>${b.title}</b><br><span style="color:${b.color}">${b.badge}</span></div>
                    </div>
                    <i class="fas fa-trash" style="color:var(--accent-red); cursor:pointer; padding:5px;" onclick="delBan(${idx})"></i>
                </div>`;
            });
        }
        async function saveBanner() {
            const title = document.getElementById('bf-title').value;
            const badge = document.getElementById('bf-badge').value;
            const color = document.getElementById('bf-color').value;
            const img = document.getElementById('bf-img').value;

            if(!img) return showToast("–ù—É–∂–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞", true);

            STATE.banners.push({ id: Date.now(), title, badge, color, img });
            await cloudSave();
            renderAdmPromo(); renderBanners();
            document.getElementById('bf-title').value='';
            document.getElementById('bf-img').value='';
        }
        function delBan(idx) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å –±–∞–Ω–Ω–µ—Ä?")) {
                STATE.banners.splice(idx, 1);
                cloudSave(); renderAdmPromo(); renderBanners();
            }
        }

        // --- ADMIN CATS ---
        function renderAdmCats() {
            const l = document.getElementById('adm-cat-list');
            l.innerHTML = '';
            STATE.categories.forEach(c => {
                if(c.id !== 'all') l.innerHTML += `
                <div style="background:#1a1a1a; padding:10px; border-radius:10px; margin-bottom:5px; display:flex; justify-content:space-between;">
                    <span style="font-size:12px;">${c.name} (${c.id})</span>
                    <i class="fas fa-trash" style="color:var(--accent-red); cursor:pointer;" onclick="delCat('${c.id}')"></i>
                </div>`;
            });
        }
        async function saveCat() {
            const id = document.getElementById('cf-id').value;
            const name = document.getElementById('cf-name').value;
            if(!id) return;
            STATE.categories.push({ id, name });
            await cloudSave(); renderAdmCats(); renderCats();
            document.getElementById('cf-id').value = ''; document.getElementById('cf-name').value = '';
        }
        function delCat(id) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?")) {
                STATE.categories = STATE.categories.filter(c => c.id !== id);
                cloudSave(); renderAdmCats(); renderCats();
            }
        }

        // =================================================================
        // HELPERS
        // =================================================================
        function handleUpload(input, targetId, prevId) {
            const f = input.files[0];
            if(!f) return;
            // 200KB LIMIT to protect JSONBin
            if(f.size > 200000) return alert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –°–∂–∞—Ç–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ. –ò—Å–ø–æ–ª—å–∑—É–π —Å—Å—ã–ª–∫—É.");
            
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById(targetId).value = e.target.result;
                updPreview(e.target.result, prevId);
            };
            reader.readAsDataURL(f);
        }
        function updPreview(src, id) {
            const el = document.getElementById(id);
            if(src) { el.src = src; el.style.display = 'block'; } else el.style.display = 'none';
        }

        function switchView(view, el) {
            document.querySelectorAll('.view-section').forEach(x => x.style.display = 'none');
            document.getElementById('view-' + view).style.display = 'block';
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
            if(el) el.classList.add('active');
            
            if(view === 'fav') renderFavs();
            document.getElementById('main-scroll').scrollTo({top:0});
        }

        function openSheet(id) {
            document.getElementById('overlay').classList.add('show');
            document.getElementById(id).classList.add('show');
        }
        function closeAll() {
            document.getElementById('overlay').classList.remove('show');
            document.querySelectorAll('.sheet').forEach(x => x.classList.remove('show'));
        }

        function saveUser() {
            localStorage.setItem('cs_user_v1', JSON.stringify(USER));
            updateCartBadge();
        }
        function updateCartBadge() {
            const c = USER.cart.reduce((a,b) => a+b.q, 0);
            const el = document.getElementById('cart-counter');
            el.innerText = c;
            c > 0 ? el.classList.add('visible') : el.classList.remove('visible');
        }
        function clearCache() {
            localStorage.removeItem('cs_user_v1');
            location.reload();
        }

        function showToast(msg, err = false) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.className = err ? 'error show' : 'success show';
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function initStars() {
            const cvs = document.getElementById('star-canvas');
            const ctx = cvs.getContext('2d');
            let w = cvs.width = window.innerWidth;
            let h = cvs.height = window.innerHeight;
            const stars = Array(60).fill().map(() => ({
                x: Math.random() * w, y: Math.random() * h,
                size: Math.random() * 1.5, speed: Math.random() * 0.3
            }));
            function anim() {
                ctx.clearRect(0, 0, w, h);
                ctx.fillStyle = "rgba(255,255,255,0.5)";
                stars.forEach(s => {
                    s.y -= s.speed; if (s.y < 0) s.y = h;
                    ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2); ctx.fill();
                });
                requestAnimationFrame(anim);
            }
            anim();
        }
    </script>
</body>
</html>
