<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PARADISE: SYSTEM</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --accent: #ec4899;
            --success: #10b981;
            --bg-body: #f1f5f9;
            --text-main: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.8);
            --glass-border: 1px solid rgba(255, 255, 255, 0.5);
            --blur: blur(12px);
            
            /* Admin Theme */
            --adm-bg: #0f172a;
            --adm-card: #1e293b;
            --adm-border: #334155;
            --adm-text: #f8fafc;
            --adm-accent: #818cf8;
        }

        [data-theme="dark"] {
            --bg-body: #020617;
            --text-main: #f8fafc;
            --card-bg: rgba(30, 41, 59, 0.7);
            --glass-border: 1px solid rgba(255, 255, 255, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-body); color: var(--text-main); font-family: 'Outfit', sans-serif; padding-bottom: 100px; transition: 0.3s; }

        /* --- –ñ–ò–í–û–ô –§–û–ù --- */
        .bg-fx { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
        .orb { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.4; animation: float 10s infinite alternate; }
        .orb-1 { width: 300px; height: 300px; background: #6366f1; top: -50px; left: -50px; }
        .orb-2 { width: 250px; height: 250px; background: #ec4899; bottom: -50px; right: -50px; animation-delay: -2s; }
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(20px, 40px); } }

        /* HEADER */
        header { position: sticky; top: 10px; z-index: 50; padding: 12px 20px; margin: 0 10px; display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); backdrop-filter: var(--blur); border-radius: 20px; border: var(--glass-border); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1); }
        .logo { font-size: 20px; font-weight: 900; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -0.5px; }
        .h-btn { width: 38px; height: 38px; border-radius: 12px; background: rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .h-btn:active { transform: scale(0.9); background: var(--primary); color: white; }

        /* LINKS */
        .links { display: flex; gap: 10px; padding: 15px 12px; }
        .lnk { flex: 1; padding: 14px; background: var(--card-bg); border-radius: 18px; text-decoration: none; color: var(--text-main); font-weight: 700; text-align: center; border: var(--glass-border); box-shadow: 0 5px 15px rgba(0,0,0,0.05); font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .lnk i { color: var(--primary); }

        /* GRID */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 12px; }
        .card { background: var(--card-bg); border-radius: 24px; padding: 8px; border: var(--glass-border); position: relative; overflow: hidden; transition: 0.3s; }
        .card:active { transform: scale(0.97); }
        .img-h { width: 100%; padding-top: 100%; position: relative; border-radius: 18px; overflow: hidden; background: rgba(0,0,0,0.05); }
        .img-h img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .c-inf { padding: 10px 5px 5px; }
        .c-tit { font-weight: 700; font-size: 15px; margin-bottom: 4px; line-height: 1.2; }
        .c-prc { font-weight: 800; color: var(--primary); font-size: 16px; }

        /* PRODUCT SHEET */
        .sheet-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 100; opacity: 0; pointer-events: none; transition: 0.3s; }
        .sheet-bg.active { opacity: 1; pointer-events: all; }
        
        .sheet { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-body); border-radius: 35px 35px 0 0; padding: 25px; z-index: 101; transform: translateY(110%); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow: 0 -10px 50px rgba(0,0,0,0.2); }
        .sheet.active { transform: translateY(0); }

        .sh-top { display: flex; gap: 15px; margin-bottom: 20px; }
        .sh-img { width: 70px; height: 70px; border-radius: 16px; object-fit: cover; background: #ddd; }
        .tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .tag { padding: 8px 14px; border-radius: 10px; background: rgba(0,0,0,0.05); font-size: 13px; font-weight: 600; border: 1px solid transparent; transition: 0.2s; }
        .tag.active { background: var(--text-main); color: var(--bg-body); border-color: transparent; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

        /* PROMO INPUT */
        .promo-box { display: flex; gap: 8px; margin-bottom: 20px; background: rgba(0,0,0,0.03); padding: 5px; border-radius: 14px; border: 1px solid rgba(0,0,0,0.05); }
        .promo-inp { flex: 1; background: transparent; border: none; padding: 10px; outline: none; font-family: 'Outfit'; font-weight: 600; color: var(--text-main); }
        .promo-btn { background: var(--text-main); color: var(--bg-body); border: none; padding: 0 15px; border-radius: 10px; font-weight: 700; font-size: 12px; }
        
        .price-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-size: 18px; font-weight: 800; }
        .old-price { text-decoration: line-through; color: #999; font-size: 14px; margin-right: 10px; display: none; }
        .old-price.show { display: inline; }

        .main-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; border-radius: 18px; font-size: 16px; font-weight: 800; box-shadow: 0 10px 30px -5px rgba(99, 102, 241, 0.5); display: flex; justify-content: center; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .main-btn:active { transform: scale(0.96); }

        /* --- ADMIN PANEL 2.0 (DASHBOARD) --- */
        .adm { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--adm-bg); z-index: 200; display: none; color: var(--adm-text); overflow-y: auto; }
        .adm.show { display: block; animation: fade 0.2s; }
        
        .adm-head { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--adm-border); background: rgba(15, 23, 42, 0.95); position: sticky; top: 0; z-index: 10; }
        .adm-title { font-weight: 800; font-size: 18px; color: var(--adm-accent); letter-spacing: 1px; }
        
        .tabs { display: flex; gap: 10px; padding: 15px 20px; }
        .tab { flex: 1; padding: 10px; text-align: center; background: var(--adm-card); border-radius: 10px; border: 1px solid var(--adm-border); color: #94a3b8; font-weight: 600; font-size: 13px; transition: 0.2s; }
        .tab.active { background: var(--adm-accent); color: white; border-color: var(--adm-accent); }

        .adm-content { padding: 0 20px 40px; }
        .adm-sec { display: none; }
        .adm-sec.active { display: block; animation: slideUp 0.3s; }

        .inp-grp { margin-bottom: 15px; }
        .lbl { font-size: 12px; color: #94a3b8; margin-bottom: 5px; display: block; font-weight: 600; text-transform: uppercase; }
        .adm-inp { width: 100%; background: var(--adm-card); border: 1px solid var(--adm-border); color: white; padding: 14px; border-radius: 12px; outline: none; font-family: 'Outfit'; transition: 0.2s; }
        .adm-inp:focus { border-color: var(--adm-accent); box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.2); }

        .up-box { height: 100px; border: 2px dashed var(--adm-border); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #64748b; margin-bottom: 20px; cursor: pointer; }
        .up-box:active { background: var(--adm-card); border-color: var(--adm-accent); }

        .adm-btn { width: 100%; padding: 15px; background: var(--adm-accent); border: none; border-radius: 12px; color: white; font-weight: 700; font-size: 14px; text-transform: uppercase; margin-top: 10px; }

        .item-row { display: flex; align-items: center; gap: 15px; padding: 12px; background: var(--adm-card); border-radius: 12px; border: 1px solid var(--adm-border); margin-bottom: 10px; }
        .item-img { width: 45px; height: 45px; border-radius: 8px; background: #333; object-fit: cover; }
        .del-btn { width: 35px; height: 35px; border-radius: 8px; background: rgba(239, 68, 68, 0.2); color: #ef4444; display: flex; align-items: center; justify-content: center; margin-left: auto; }

        /* AUTH */
        .auth { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; flex-direction: column; }
        
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: #10b981; color: white; padding: 10px 20px; border-radius: 30px; font-weight: 700; z-index: 2000; transition: 0.4s; display: flex; align-items: center; gap: 8px; box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3); }
        .toast.err { background: #ef4444; box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3); }
        .toast.show { transform: translateX(-50%) translateY(0); }

        @keyframes fade { from{opacity:0} to{opacity:1} }
        @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }
    </style>
</head>
<body>

    <div class="bg-fx">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <header>
        <div class="logo">PARADISE</div>
        <div style="display:flex; gap:10px;">
            <div class="h-btn" onclick="toggleTheme()"><i class="fas fa-adjust"></i></div>
            <div class="h-btn" onclick="openAuth()"><i class="fas fa-tools"></i></div>
        </div>
    </header>

    <div class="links">
        <a href="https://t.me/sparadiseinfo" class="lnk" target="_blank">
            <i class="fas fa-info-circle"></i> INFO
        </a>
        <a href="https://t.me/+N8WkPq6XQ6I5MjJk" class="lnk" target="_blank">
            <i class="fas fa-paper-plane"></i> CHANNEL
        </a>
    </div>

    <div class="grid" id="grid"></div>

    <div class="sheet-bg" id="modalBg"></div>
    <div class="sheet" id="sheet">
        <div class="sh-top">
            <img src="" class="sh-img" id="sImg">
            <div>
                <h2 id="sTitle" style="font-size: 18px; margin-bottom: 5px; line-height: 1.2;">Product</h2>
                <div id="sDesc" style="font-size: 12px; opacity: 0.6; max-height: 50px; overflow-y: auto;"></div>
            </div>
        </div>

        <div style="font-size: 11px; font-weight: 800; opacity: 0.4; text-transform: uppercase; margin-bottom: 10px;">–í–∫—É—Å—ã</div>
        <div class="tags" id="sFlavors"></div>

        <div class="promo-box">
            <input type="text" class="promo-inp" id="promoInput" placeholder="–ï—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥?">
            <button class="promo-btn" onclick="applyPromo()">OK</button>
        </div>

        <div class="price-row">
            <div style="display:flex; gap:15px; align-items:center;">
                <button class="h-btn" onclick="updQty(-1)">-</button>
                <span id="sQty">1</span>
                <button class="h-btn" onclick="updQty(1)">+</button>
            </div>
            <div>
                <span class="old-price" id="sOldPrice"></span>
                <span id="sTotal" style="color:var(--primary);">0 ‚Ç¨</span>
            </div>
        </div>

        <button class="main-btn" id="orderBtn">
            –ó–ê–ö–ê–ó–ê–¢–¨ <i class="fas fa-arrow-right"></i>
        </button>
    </div>

    <div class="adm" id="admPanel">
        <div class="adm-head">
            <div class="adm-title"><i class="fas fa-rocket"></i> DASHBOARD</div>
            <button onclick="toggleAdmin(false)" style="background:none; border:none; color:white; font-size:20px;">&times;</button>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('goods', this)">–¢–û–í–ê–†–´</div>
            <div class="tab" onclick="switchTab('promos', this)">–ü–†–û–ú–û–ö–û–î–´</div>
        </div>

        <div class="adm-content">
            <div class="adm-sec active" id="sec-goods">
                <div class="up-box" onclick="document.getElementById('fileIn').click()">
                    <i class="fas fa-camera" style="font-size:24px; margin-bottom:10px;"></i>
                    <span>–ù–∞–∂–º–∏ –¥–ª—è —Ñ–æ—Ç–æ</span>
                    <img id="previewImg" style="display:none; width:50px; height:50px; margin-top:5px; border-radius:8px;">
                    <input type="file" id="fileIn" hidden accept="image/*">
                </div>
                
                <div class="inp-grp"><span class="lbl">–ù–∞–∑–≤–∞–Ω–∏–µ</span><input id="inpName" class="adm-inp" placeholder="Elfbar..."></div>
                <div style="display:flex; gap:10px;">
                    <div class="inp-grp" style="flex:1;"><span class="lbl">–¶–µ–Ω–∞ (‚Ç¨)</span><input id="inpPrice" type="number" class="adm-inp" placeholder="15"></div>
                    <div class="inp-grp" style="flex:2;"><span class="lbl">–í–∫—É—Å—ã (CSV)</span><input id="inpFlavors" class="adm-inp" placeholder="Apple, Mint..."></div>
                </div>
                
                <button class="adm-btn" onclick="saveProduct()">–î–û–ë–ê–í–ò–¢–¨ –¢–û–í–ê–†</button>
                <div style="margin: 20px 0 10px; font-size: 11px; font-weight: 700; color: #64748b;">–ë–ê–ó–ê –¢–û–í–ê–†–û–í</div>
                <div id="goodsList"></div>
            </div>

            <div class="adm-sec" id="sec-promos">
                <div class="inp-grp"><span class="lbl">–ö–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä SALE10)</span><input id="pmCode" class="adm-inp" style="text-transform:uppercase;"></div>
                <div style="display:flex; gap:10px;">
                    <div class="inp-grp" style="flex:1;"><span class="lbl">–°–∫–∏–¥–∫–∞ %</span><input id="pmDisc" type="number" class="adm-inp" placeholder="10"></div>
                    <div class="inp-grp" style="flex:1;"><span class="lbl">–õ–∏–º–∏—Ç</span><input id="pmLimit" type="number" class="adm-inp" placeholder="50"></div>
                </div>
                
                <button class="adm-btn" style="background:#10b981;" onclick="savePromo()">–°–û–ó–î–ê–¢–¨ –ü–†–û–ú–û–ö–û–î</button>
                <div style="margin: 20px 0 10px; font-size: 11px; font-weight: 700; color: #64748b;">–ê–ö–¢–ò–í–ù–´–ï –ö–û–î–´</div>
                <div id="promosList"></div>
            </div>
        </div>
    </div>

    <div class="auth" id="authBox">
        <i class="fas fa-fingerprint" style="font-size:50px; color:var(--primary); margin-bottom:20px;"></i>
        <input type="password" id="passInput" class="adm-inp" style="width:200px; text-align:center; margin-bottom:15px;" placeholder="Password">
        <button class="adm-btn" style="width:200px;" onclick="checkPass()">LOGIN</button>
        <button onclick="document.getElementById('authBox').style.display='none'" style="margin-top:15px; background:none; border:none; color:#64748b;">CLOSE</button>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // === CONFIG ===
        const BIN_ID = "696ea19bd0ea881f4076e7ce";
        const API_KEY = "$2a$10$L2N3z0hcYt/KjMIcI402euuF0nMvX.RMLI8RCugRIyy6/NX7K3QXy";
        const ADMIN_PASS = "Inn2708inNfnaf1234";
        const USERNAME = "Lacky337"; 

        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        // Data State
        let db = { products: [], promos: [] };
        
        // Cart State
        let curProd = null;
        let curQty = 1;
        let curFlavor = '';
        let activeDiscount = 0;
        let activePromoCode = '';

        // --- INIT ---
        window.onload = loadData;

        async function loadData() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { 'X-Master-Key': API_KEY } });
                if(res.ok) {
                    const data = await res.json();
                    // Migration logic: if old structure (array), convert to object
                    if(Array.isArray(data.record)) {
                        db.products = data.record;
                        db.promos = [];
                    } else {
                        db = data.record;
                        if(!db.promos) db.promos = [];
                    }
                }
                renderShop();
                renderAdmin();
            } catch(e) { console.error(e); }
        }

        async function syncData() {
            showToast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...", false);
            try {
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
                    body: JSON.stringify(db)
                });
                showToast("–£—Å–ø–µ—à–Ω–æ!", false);
            } catch(e) { showToast("–û—à–∏–±–∫–∞!", true); }
        }

        // --- SHOP UI ---
        function renderShop() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            if(db.products.length === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:50px;opacity:0.5">–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç</div>';
                return;
            }
            db.products.forEach(p => {
                const el = document.createElement('div');
                el.className = 'card';
                let im = p.image ? `<img src="${p.image}">` : `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;opacity:0.3"><i class="fas fa-box fa-2x"></i></div>`;
                el.innerHTML = `<div class="img-h">${im}</div><div class="c-inf"><div class="c-tit">${p.name}</div><div class="c-prc">${p.price} ‚Ç¨</div></div>`;
                el.onclick = () => openSheet(p);
                grid.appendChild(el);
            });
        }

        function openSheet(p) {
            curProd = p; curQty = 1; activeDiscount = 0; activePromoCode = '';
            document.getElementById('sImg').src = p.image || '';
            document.getElementById('sTitle').innerText = p.name;
            document.getElementById('sDesc').innerText = p.desc || '';
            document.getElementById('promoInput').value = '';
            document.getElementById('sOldPrice').classList.remove('show');
            
            // Render Flavors
            const con = document.getElementById('sFlavors');
            con.innerHTML = '';
            if(p.flavors && p.flavors.length) {
                curFlavor = p.flavors[0];
                p.flavors.forEach(f => {
                    const tag = document.createElement('div');
                    tag.className = `tag ${f === curFlavor ? 'active' : ''}`;
                    tag.innerText = f;
                    tag.onclick = () => {
                        curFlavor = f;
                        document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
                        tag.classList.add('active');
                        tg.HapticFeedback.selectionChanged();
                    };
                    con.appendChild(tag);
                });
            } else {
                curFlavor = 'Standard';
                con.innerHTML = '<span style="font-size:12px;opacity:0.5">–ë–µ–∑ –≤–∫—É—Å–æ–≤</span>';
            }
            
            calcTotal();
            document.getElementById('modalBg').classList.add('active');
            document.getElementById('sheet').classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        function updQty(v) {
            if(curQty + v < 1) return;
            curQty += v;
            document.getElementById('sQty').innerText = curQty;
            calcTotal();
            tg.HapticFeedback.selectionChanged();
        }

        function applyPromo() {
            const code = document.getElementById('promoInput').value.trim().toUpperCase();
            if(!code) return;
            
            const promo = db.promos.find(p => p.code === code);
            
            if(promo) {
                if(promo.limit > 0 && promo.used >= promo.limit) {
                    showToast('–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω', true);
                    return;
                }
                activeDiscount = promo.discount;
                activePromoCode = promo.code;
                calcTotal();
                showToast(`–°–∫–∏–¥–∫–∞ -${promo.discount}%!`, false);
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥', true);
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        function calcTotal() {
            let base = parseFloat(curProd.price) * curQty;
            const final = activeDiscount > 0 ? base * (1 - activeDiscount/100) : base;
            
            const totalEl = document.getElementById('sTotal');
            const oldEl = document.getElementById('sOldPrice');
            
            totalEl.innerText = final.toFixed(2) + ' ‚Ç¨';
            
            if(activeDiscount > 0) {
                oldEl.innerText = base.toFixed(2) + ' ‚Ç¨';
                oldEl.classList.add('show');
            } else {
                oldEl.classList.remove('show');
            }
        }

        document.getElementById('orderBtn').onclick = () => {
            let total = parseFloat(curProd.price) * curQty;
            if(activeDiscount > 0) total = total * (1 - activeDiscount/100);

            let msg = `üî• *–ó–ê–ö–ê–ó PARADISE*\n\n` +
                      `üì¶ *–¢–æ–≤–∞—Ä:* ${curProd.name}\n` +
                      `üçì *–í–∫—É—Å:* ${curFlavor}\n` +
                      `üî¢ *–ö–æ–ª-–≤–æ:* ${curQty}\n`;
            
            if(activeDiscount > 0) {
                msg += `üéü *–ü—Ä–æ–º–æ–∫–æ–¥:* ${activePromoCode} (-${activeDiscount}%)\n`;
            }
            
            msg += `üí∞ *–ò–¢–û–ì–û:* ${total.toFixed(2)} ‚Ç¨`;

            // Smart Sending
            const url = `https://t.me/${USERNAME}?text=${encodeURIComponent(msg)}`;
            try { tg.openTelegramLink(url); } catch(e) { window.location.href = url; }
            tg.close();
        }

        // --- ADMIN UI ---
        function switchTab(sec, btn) {
            document.querySelectorAll('.adm-sec').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('sec-'+sec).classList.add('active');
            btn.classList.add('active');
        }

        function renderAdmin() {
            // Render Goods
            const gl = document.getElementById('goodsList');
            gl.innerHTML = '';
            db.products.forEach(p => {
                const d = document.createElement('div');
                d.className = 'item-row';
                let im = p.image ? `<img src="${p.image}" class="item-img">` : `<div class="item-img"></div>`;
                d.innerHTML = `${im}<div style="flex:1;"><div style="font-weight:700;font-size:14px;">${p.name}</div><div style="font-size:12px;color:#94a3b8;">${p.price} ‚Ç¨</div></div><div class="del-btn" onclick="delProduct(${p.id})"><i class="fas fa-trash"></i></div>`;
                gl.appendChild(d);
            });

            // Render Promos
            const pl = document.getElementById('promosList');
            pl.innerHTML = '';
            db.promos.forEach(pr => {
                const d = document.createElement('div');
                d.className = 'item-row';
                d.innerHTML = `<div style="flex:1;"><div style="font-weight:700;color:var(--adm-accent);">${pr.code}</div><div style="font-size:12px;color:#94a3b8;">-${pr.discount}% (–û—Å—Ç: ${pr.limit - (pr.used||0)})</div></div><div class="del-btn" onclick="delPromo('${pr.code}')"><i class="fas fa-trash"></i></div>`;
                pl.appendChild(d);
            });
        }

        // Admin Actions
        async function saveProduct() {
            const n = document.getElementById('inpName').value;
            const p = document.getElementById('inpPrice').value;
            const f = document.getElementById('inpFlavors').value.split(',').filter(x=>x.trim());
            const img = document.getElementById('previewImg').src;
            
            if(!n || !p) return showToast('–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è', true);
            
            db.products.unshift({
                id: Date.now(),
                name: n, price: p, flavors: f, 
                image: img.startsWith('data') ? img : ''
            });
            
            renderAdmin(); syncData();
            document.getElementById('inpName').value = '';
        }

        async function savePromo() {
            const c = document.getElementById('pmCode').value.toUpperCase().trim();
            const d = document.getElementById('pmDisc').value;
            const l = document.getElementById('pmLimit').value;
            
            if(!c || !d) return showToast('–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è', true);

            // Remove if exists
            db.promos = db.promos.filter(x => x.code !== c);
            
            db.promos.unshift({
                code: c, discount: parseInt(d), limit: parseInt(l) || 9999, used: 0
            });
            
            renderAdmin(); syncData();
            document.getElementById('pmCode').value = '';
        }

        async function delProduct(id) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å?')) { db.products = db.products.filter(x => x.id !== id); renderAdmin(); syncData(); }
        }
        async function delPromo(code) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–¥?')) { db.promos = db.promos.filter(x => x.code !== code); renderAdmin(); syncData(); }
        }

        // Image Handling
        document.getElementById('fileIn').onchange = (e) => {
            const f = e.target.files[0]; if(!f) return;
            const r = new FileReader();
            r.onload = (ev) => {
                const i = new Image(); i.onload = () => {
                    const c = document.createElement('canvas'); const x = c.getContext('2d');
                    const m = 600; let w=i.width, h=i.height;
                    if(w>h){if(w>m){h*=m/w;w=m}}else{if(h>m){w*=m/h;h=m}}
                    c.width=w; c.height=h; x.drawImage(i,0,0,w,h);
                    const d = c.toDataURL('image/jpeg', 0.8);
                    document.getElementById('previewImg').src = d;
                    document.getElementById('previewImg').style.display = 'block';
                }; i.src = ev.target.result;
            }; r.readAsDataURL(f);
        }

        // Helpers
        function showToast(tx, err) {
            const t = document.getElementById('toast');
            t.className = `toast ${err ? 'err' : ''} show`;
            t.innerHTML = err ? `<i class="fas fa-times"></i> ${tx}` : `<i class="fas fa-check"></i> ${tx}`;
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function openAuth() { document.getElementById('authBox').style.display = 'flex'; }
        function checkPass() {
            if(document.getElementById('passInput').value === ADMIN_PASS) {
                document.getElementById('authBox').style.display = 'none';
                toggleAdmin(true);
            } else showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', true);
        }
        function toggleAdmin(s) {
            const p = document.getElementById('admPanel');
            if(s) { p.classList.add('show'); renderAdmin(); }
            else p.classList.remove('show');
        }
        function toggleTheme() {
            const b = document.body;
            b.setAttribute('data-theme', b.getAttribute('data-theme')==='dark'?'light':'dark');
        }
        
        // Modal close
        document.getElementById('modalBg').onclick = () => {
            document.getElementById('modalBg').classList.remove('active');
            document.getElementById('sheet').classList.remove('active');
        }
    </script>
</body>
</html>
